#include <stdio.h>
#include "system.h"
/* * === FUNCTION ====================================
 * * Name: dpy_decode
 * * Description: 数码管译码函数，将0~9译成数码管段码值
 * * =================================================== */
unsigned char dpy_decode(unsigned char number)
{
	switch(number)
	{
	 case 0x0:return 0x03;
	 case 0x1:return 0x9F;
	 case 0x2:return 0x25;
	 case 0x3:return 0x0D;
	 case 0x4:return 0x99;
	 case 0x5:return 0x49;
	 case 0x6:return 0x41;
	 case 0x7:return 0x1F;
	 case 0x8:return 0x01;
	 case 0x9:return 0x09;
	 default:return 0xff;
	}
	return 0xff;
}

/* * === FUNCTION ====================================
 * * Name: dpy_display
 *  * Description: 数码管显示函数
 *   * =================================================== */
void dpy_display(unsigned int number)
{
	int *dpy_num = (int*)SMG_CONTROLLER_0_BASE;
	int i;
	unsigned int j=10000000;
	unsigned char display[8];
	for (i=7;i>=0;i--)
	{
		display[i]= number / j;
		number -= j * display[i];
		j /= 10;
	}
	*(dpy_num+1) = (dpy_decode(display[0]) << 24) +(dpy_decode(display[1]) << 16) +(dpy_decode(display[2]) << 8) + dpy_decode(display[3]);
	*dpy_num = (dpy_decode(display[4]) << 24) +(dpy_decode(display[5]) << 16) +(dpy_decode(display[6]) << 8) + dpy_decode(display[7]);
}

/* * === FUNCTION ====================================
 * * Name: main
 * * Description: 主函数，从0开始计数并将值显示到数码管上
 * * =================================================== */
int main()
{
	printf("Hello from Nios II!\n");
	int i=0,j=10000;
	while(1)
	{
		dpy_display(i);
		while(j--);
		j=1000000;
	}
	return 0;
}

